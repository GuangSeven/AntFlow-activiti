# 消息系统接入

前面章节已经介绍过，AntFlow支持丰富的消息通知配置，但是目前仅实现了邮件通知，为了快速体验起来，需要先配置发送邮件服务器。

## 1 发送邮件服务器配置

进入项目antflow-web模块，找到resources目录下的application.properteis，将里面邮件服务器配置改为自己的即可

```
# email notification config
message.email.host=smtp.163.com
message.email.account=antflow@163.com
message.email.password=HHVZDETFJMCATUGS
```

> 很多主流的邮件都支持邮件代收与代码，但是不同的配置不一样。如果没有配置想要快速配置的可以看我之前写过的[一篇文章](https://blog.csdn.net/zypqqgc/article/details/142029672?spm=1011.2415.3001.5331)

## 2.开启流程消息通知

### 2.1 开启消息通知

进入到系统【流程管理】-【流程类型】里面，列表项后面有操作工具栏，点击铃铛图标进行设置，即可开启消息通知。

### 2.2 设计消息通知模板

目前消息通知模板功能已开发完成，但是还未加入页面交互，用户可以指定路由#/flowMsg/msgTemp访问消息通知模板页面

> 关于消息通知模板事件类型的说明，事件类型主要是为了给模板分类，大企业往往有很多自定义消息通知需求，模板太多下拉选择时很困难。事件类型主要是为了过滤消息模板
>
> 比如用户想要在流程完成时自定义消息通知，那么他需要的模板都是跟完成事件模板，而不是流程同意或者不同意时的消息模板。但是为了减少用户体验难度，选择模板时并没有
>
> 结合当前消息事件对模板进行过滤，即可选的是全部模板，用户集成时可以自己加上过滤条件。

#### 关于模板编辑流程模板变量说明

流程模板变量提供了常用的模板变量，用户可以使用自定义内容+模板变量来完成消息通知设置。比如消息主题设计为:你有一个{工作流名称}流程需要审批，在通知时会自动将{工作流名称}替换为实际工作流的名称.需要注意的是用户编辑信息时，删除模板变量一定要删除全，不然可能会影响模板消息的解析。

## 3.高级消息通知设置

高级通知设置入口和开启通知设置是一样的,在【流程管理】-【流程类型】操作栏里面,点击【铃铛】图标，默认是开启通知设置，有一个【高级通知设置】tab

⚠️⚠️⚠️需要说明的是,高级通知设置一般用于更精细控制流程通知，不是必须的。通过开启【默认通知设置】tab消息通知，即可达到最小化通知设置，消息模板在MsgNoticeTypeEnum里

## 4.流程通知设置

在设计流程模板时，如果用户选择的是审批人节点设置，在弹出的右侧panel最后一个tab是通知设置，用户便可以设置通知类型了。

> 需要说明的是，在前面第二节流程消息通知设置里可以选择通知的类型，在审批人节点消息通知设置里也会出现相同的选项。第2节里面是全局的，节点级别的是局部的。即便全局的没有设置，在节点消息通知里设置了仍然会生效。

⚠️⚠️⚠️需要说明的是，流程节点通知非必须。最小化配置只需要执行第二节点里面开启消息通知即可。AntFlow有默认的消息通知模板，即便用户不进行配置也会按默认模板进行消息通知，节点级别的相当于自定义消息通知，如果用户设置了，就会覆盖默认的。默认消息模板在MsgNoticeTypeEnum，如果用户想更改需要无法在页面进行更改，需要修改枚举

### 4.1 消息通知优先级

节点级别通知>高级通知>默认通知

## 5.消息通知系统扩展

目前antflow可以配置的消息通知类型都定义在了ProcessNoticeEnum,但是AntFlow自身只实现了邮件发送,其它的比如发送短信可以按照自己的需求进行扩展,由于采用的是策略模式,用户只需要实现相应策略即可将自己的逻辑插入到流程流转的过程中,而不用关心整体逻处理逻辑.大大降低上手难度.

### 5.1 将自己要实现的通知类型选项加入到ProcessNoticeEnum里面(如果没有的话)

### 5.2 将自己要实现的消息通知发送类型加入到MessageSendTypeEnum里(这里一般要和5.1保持一致,但是也可以不一致)

### 5.3 实现ProcessNoticeAdaptor,可以参照EmailSendAdaptor来实现
